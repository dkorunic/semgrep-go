rules:
  - id: err-overwrite
    patterns:
      - pattern-either:
          - pattern: |
              err = ...
          - pattern: |
              err, ... = ...
          - pattern: |
              ..., err = ...
      - pattern-inside: |
          go func(...) {
            ...
          }(...)
      - pattern-not-inside: |
          go func(...) {
            ...
            err := ...
            ...
          }(...)
      - pattern-not-inside: |
          go func(...) {
            ...
            ..., err := ...
            ...
          }(...)
      - pattern-not-inside: |
          go func(...) {
            ...
            err, ... := ...
            ...
          }(...)
    message: "possibly unsafely overwriting err from goroutines"
    languages: [go]
    severity: ERROR
